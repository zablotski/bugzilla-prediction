var connect = require('connect'),
    serveStatic = require('serve-static'),
    fs = require("fs"),
    path = require("path");

var browserFile = 'bz-0.3.0.js'; // brittle
var root = path.join(__dirname, "files");
var srcPath = path.resolve(path.join(__dirname, '../../', browserFile));

// move the current build into place
fs.readFile(srcPath, {encoding: 'utf8'}, function(err, data) {
  if (err) throw err;
  fs.writeFile(path.join(root, 'bz.js'), data, function(err) {
    if (err) throw err;
    var PORT = process.env.PORT || 3000;
    var server = connect();
    server
      .use(serveStatic(root))
      .listen(PORT, function() {
        console.log("visit http://127.0.0.1:%d/index.html", PORT);
      });
  });
});
